<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} - Attendance System</title>

    <!-- Import DM Sans from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, sans-serif; 
            margin: 0; 
            background-color: #f8f9fa; 
        }
        .container { display: flex; }
        .sidebar { width: 220px; background-color: #252627; color: white; height: 100vh; padding: 20px; }
        .sidebar h2 { color: #f8f9fa; font-weight: 600; }
        .sidebar a { color: #adb5bd; text-decoration: none; display: block; padding: 10px 15px; border-radius: 4px; margin-bottom: 5px; }
        .sidebar a:hover, .sidebar a.active { background-color: #5B649F; color: white; }
        .main-content { flex-grow: 1; padding: 30px; }
        .card { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ced4da; border-radius: 4px; }
        button { background-color: #5B649F; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #dee2e6; text-align: left; }
        th { background-color: #e9ecef; }
        .toast-container { position: fixed; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 12px; z-index: 2000; }
        .toast { position: relative; min-width: 260px; padding: 12px 48px 12px 16px; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); color: #fff; font-size: 14px; background-color: #5B649F; animation: slideIn 0.3s ease-out; display: flex; align-items: center; }
        .toast.toast-success { background-color: #28a745; }
        .toast.toast-error { background-color: #dc3545; }
        .toast.toast-warning { background-color: #ffc107; color: #212529; }
        .toast.toast-info { background-color: #17a2b8; }
        .toast-close { position: absolute; top: 50%; right: 12px; transform: translateY(-50%); background: transparent; border: none; color: #fff; width: 22px; height: 22px; font-size: 16px; line-height: 22px; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .toast-close:hover { opacity: 0.8; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pagination-loading { position: relative; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>
    <div class="container">
        {% if session.logged_in %}
        <div class="sidebar">
            <h2>CelebKids Egbeda</h2>
            <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
            <a href="{{ url_for('attendance_log') }}">Attendance</a>
            <a href="{{ url_for('children_list') }}">Children</a>
            <a href="{{ url_for('reports') }}">Reports</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
        {% endif %}
        <div class="main-content">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="toast-container">
            {% for category, message in messages %}
                <div class="toast toast-{{ category }}" data-toast>
                    {{ message }}
                    <button type="button" class="toast-close" aria-label="Close" data-toast-close>&times;</button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}
            {% block content %}{% endblock %}
        </div>
    </div>
</body>
<script>
(function() {
  const toasts = Array.from(document.querySelectorAll('[data-toast]'));
  if (!toasts.length) return;

  const TOAST_DURATION = 5000;

  toasts.forEach((toast) => {
    const closeBtn = toast.querySelector('[data-toast-close]');
    let timeoutId = setTimeout(() => dismissToast(toast), TOAST_DURATION);

    function dismissToast(target) {
      if (!target || target.classList.contains('toast-hidden')) return;
      target.classList.add('toast-hidden');
      setTimeout(() => target.remove(), 300);
    }

    toast.addEventListener('mouseenter', () => clearTimeout(timeoutId));
    toast.addEventListener('mouseleave', () => {
      timeoutId = setTimeout(() => dismissToast(toast), TOAST_DURATION);
    });

    if (closeBtn) {
      closeBtn.addEventListener('click', () => dismissToast(toast));
    }
  });
})();
</script>
<script>
(function() {
  const supportsHistory = !!(window.history && window.history.pushState);

  function setupPaginationHandlers(root) {
    const links = (root || document).querySelectorAll('.pagination-nav a');
    links.forEach((link) => {
      if (link.dataset.paginationBound === 'true') {
        return;
      }
      link.dataset.paginationBound = 'true';
      link.addEventListener('click', handlePaginationClick);
    });
  }

  function syncPaginationForms(target, container) {
    if (!container || !container.dataset) return;
    if (target === 'attendance') {
      const current = container.dataset.paginationCurrent;
      if (!current) return;
      document.querySelectorAll('[data-pagination-sync="attendance"]').forEach((input) => {
        input.value = current;
      });
    }
  }

  function handlePaginationClick(event) {
    if (event.defaultPrevented || event.button !== 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {
      return;
    }
    const link = event.currentTarget;
    const container = link.closest('[data-pagination-container]');
    if (!container) {
      return;
    }
    event.preventDefault();
    const target = container.dataset.paginationContainer || '';
    fetchAndSwap(container, target, link.href, true);
  }

  function fetchAndSwap(container, target, url, pushHistory) {
    container.classList.add('pagination-loading');
    fetch(url, { credentials: 'same-origin' })
      .then((response) => response.text())
      .then((html) => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newContainer = doc.querySelector(`[data-pagination-container="${target}"]`);
        if (!newContainer) {
          window.location.href = url;
          return;
        }
        container.innerHTML = newContainer.innerHTML;
        if (newContainer.dataset.paginationCurrent) {
          container.dataset.paginationCurrent = newContainer.dataset.paginationCurrent;
        }
        setupPaginationHandlers(container);
        syncPaginationForms(target, container);
        if (pushHistory && supportsHistory) {
          window.history.pushState({ paginationTarget: target }, '', url);
        }
      })
      .catch(() => {
        window.location.href = url;
      })
      .finally(() => {
        container.classList.remove('pagination-loading');
      });
  }

  if (supportsHistory) {
    const state = window.history.state || {};
    if (!Object.prototype.hasOwnProperty.call(state, 'paginationTarget')) {
      window.history.replaceState({ paginationTarget: null }, '', window.location.href);
    }

    window.addEventListener('popstate', (event) => {
      const state = event.state;
      if (!state || !state.paginationTarget) {
        window.location.reload();
        return;
      }
      const container = document.querySelector(`[data-pagination-container="${state.paginationTarget}"]`);
      if (!container) {
        window.location.reload();
        return;
      }
      fetchAndSwap(container, state.paginationTarget, window.location.href, false);
    });
  }

  setupPaginationHandlers(document);
  syncPaginationForms('attendance', document.querySelector('[data-pagination-container="attendance"]'));
})();
</script>
</html>
