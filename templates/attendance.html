{% extends "layout.html" %}

{% block title %}Attendance Log{% endblock %}

{% block content %}
<div style="display: flex; gap: 30px;">

    <div class="card" style="flex: 1;">
        <h3>Check In</h3>
        <p>Assign a temporary tag for today.</p>
        
        <form method="post">
            <input type="hidden" name="action" value="check_in">
            
            <label for="child_name">Child Name</label>
            <select id="child_name" name="child_name" style="width: 100%;" required>
                <option value="">-- Select a Child --</option>
                {% for name in children_names %}
                    <option value="{{ name }}">{{ name }}</option>
                {% endfor %}
            </select>

            <label for="service_type">Service Type</label>
            <select id="service_type" name="service_type" required>
                <option value="1st Service">1st Service</option>
                <option value="2nd Service">2nd Service</option>
            </select>
            
            <label for="day_tag">Day Tag Number (1-200)</label>
            <input type="number" id="day_tag" name="day_tag" min="1" max="200" required>
            
            <button type="submit">Check In</button>
        </form>
    </div>

    <div class="card" style="flex: 1;">
        <h3>Check Out</h3>
        <p>Enter the tag number to check out.</p>

        <form method="post">
            <input type="hidden" name="action" value="checkout_by_tag">
            <label for="checkout_tag">Tag Number</label>
            <input type="number" id="checkout_tag" name="checkout_tag" required>
            <button type="submit" style="background-color: #5B649F;">Find & Check Out</button>
        </form>
    </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="card" style="margin-top: 30px;">
    <h3>Today's Log ({{ today_date }})</h3>
    <table>
        <thead>
            <tr>
                <th>Child Name</th>
                <th>Day Tag</th>
                <th>Service</th>
                <th>Check-in Time</th>
                <th>Check-out Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for record in attendance_today %}
            <tr>
                <td>{{ record['Child Name'] }}</td>
                <td><strong>{{ record['Day Tag'] }}</strong></td>
                <td>{{ record['Service'] }}</td>
                <td>{{ record['Check-in Time'] }}</td>
                <td>{{ record['Check-out Time'] }}</td>
                <td>
                    {% if record['Status'] == 'Checked-Out' %}
                        <span style="color: #dc3545;">ðŸ”´ Checked Out</span>
                    {% else %}
                        <span style="color: #28a745;">ðŸŸ¢ Checked In</span>
                    {% endif %}
                </td>
                <td>
                    <form action="{{ url_for('delete_log', row_id=record.row_id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this entry?');">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center;">No one has been checked in yet today.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <style>.delete-btn { background-color: #dc3545; padding: 5px 10px; font-size: 12px; }</style>
</div>

<!-- ðŸ”¹ Include Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function() {
    $('#child_name').select2({
      placeholder: "Search child...",
      allowClear: true
    });
  });
</script>

{% endblock %}