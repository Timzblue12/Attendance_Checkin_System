{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="card">
    <h2>Dashboard</h2>
    <p>Welcome, <strong>{{ instructor_name }}</strong>! Here is your summary for today.</p>
    {% if event_options %}
    <form method="get" style="margin-top: 10px; display: inline-block;">
        <label for="event_id">Event</label>
        <select id="event_id" name="event_id" onchange="this.form.submit()">
            {% for event in event_options %}
                <option value="{{ event.id }}" {% if event.id == selected_event_id %}selected{% endif %}>{{ event.name }}</option>
            {% endfor %}
        </select>
    </form>
    {% endif %}
</div>

<div style="display: flex; gap: 20px; margin-top: 20px;">
    <div class="card" style="flex-grow: 1;">
        <h4>Total Registered</h4>
        <h2 style="margin:0;">{{ total_children }}</h2>
    </div>
    <div class="card" style="flex-grow: 1;">
        <h4>Checked-In Today</h4>
        <h2 style="margin:0;">{{ checked_in_today }}</h2>
    </div>
</div>

<div class="card" style="margin-top: 20px;">
    <h4>Attendance by Class Today</h4>
    <div class="chart-container">
        {% for class_name, count in class_breakdown.items() %}
        <div class="chart-bar-wrapper">
            <div class="chart-label">{{ class_name }} ({{ count }})</div>
            <div class="chart-bar" style="width: {{ (count / checked_in_today * 100) if checked_in_today > 0 else 0 }}%;"></div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="card" style="margin-top: 20px;">
    <h4>Attendance by Service / Session Today</h4>
    <div class="chart-container">
         {% for session_name, count in session_breakdown.items() %}
        <div class="chart-bar-wrapper">
            <div class="chart-label">{{ session_name }} ({{ count }})</div>
            <div class="chart-bar" style="background-color: #28a745; width: {{ (count / checked_in_today * 100) if checked_in_today > 0 else 0 }}%;"></div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .chart-container { margin-top: 15px; }
    .chart-bar-wrapper { margin-bottom: 10px; }
    .chart-label { font-size: 14px; color: #555; }
    .chart-bar { height: 20px; background-color: #007bff; border-radius: 4px; margin-top: 5px; }
</style>
{% endblock %}
